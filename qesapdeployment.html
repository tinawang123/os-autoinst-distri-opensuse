<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/qesapdeployment.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='./style.css' />
</head>

<body>



<ul id="index"><li><a href="./index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li>
        <ul>
          <li><a href="#qesap_get_file_paths">qesap_get_file_paths</a></li>
          <li><a href="#qesap_create_folder_tree">qesap_create_folder_tree</a></li>
          <li><a href="#qesap_pip_install">qesap_pip_install</a></li>
          <li><a href="#qesap_upload_logs">qesap_upload_logs</a></li>
          <li><a href="#qesap_get_deployment_code">qesap_get_deployment_code</a></li>
          <li><a href="#qesap_yaml_replace">qesap_yaml_replace</a></li>
          <li><a href="#qesap_configure_tfvar">qesap_configure_tfvar</a></li>
          <li><a href="#qesap_configure_variables">qesap_configure_variables</a></li>
          <li><a href="#qesap_configure_hanamedia">qesap_configure_hanamedia</a></li>
          <li><a href="#qesap_sh">qesap_sh</a></li>
          <li><a href="#qesap_sh_deploy">qesap_sh_deploy</a></li>
          <li><a href="#qesap_sh_destroy">qesap_sh_destroy</a></li>
          <li><a href="#qesap_execute">qesap_execute</a></li>
          <li><a href="#qesap_get_inventory">qesap_get_inventory</a></li>
          <li><a href="#qesap_prepare_env">qesap_prepare_env</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul><h1>lib/qesapdeployment.pm</h1>

<h1 id="NAME">NAME</h1>

<pre><code>    qe-sap-deployment test lib</code></pre>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<pre><code>    Copyright 2022 SUSE LLC
    SPDX-License-Identifier: FSFAP</code></pre>

<h1 id="AUTHORS">AUTHORS</h1>

<pre><code>    QE SAP &lt;qe-sap@suse.de&gt;</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<pre><code>    Package with common methods and default or constant  values for qe-sap-deployment
=head2 Methods</code></pre>

<h3 id="qesap_get_file_paths">qesap_get_file_paths</h3>

<pre><code>    Returns a hash containing file paths for config files</code></pre>

<h3 id="qesap_create_folder_tree">qesap_create_folder_tree</h3>

<pre><code>    Create all needed folders</code></pre>

<h3 id="qesap_pip_install">qesap_pip_install</h3>

<pre><code>  Install all Python requirements of the qe-sap-deployment</code></pre>

<h3 id="qesap_upload_logs">qesap_upload_logs</h3>

<pre><code>    qesap_upload_logs([failok=1])

    Collect and upload logs present in @log_files.</code></pre>

<dl>

<dt id="FAILOK---used-as-failok-for-the-upload_logs.-continue-even-in-case-upload-fails"><b>FAILOK</b> - used as failok for the upload_logs. continue even in case upload fails</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_get_deployment_code">qesap_get_deployment_code</h3>

<pre><code>    Get the qe-sap-deployment code</code></pre>

<h3 id="qesap_yaml_replace">qesap_yaml_replace</h3>

<pre><code>    Replaces yaml config file variables with parameters defined by OpenQA testode, yaml template or yaml schedule.
    Openqa variables need to be added as a hash with key/value pair inside %run_args{openqa_variables}.
    Example:
        my %variables;
        $variables{HANA_SAR} = get_required_var(&quot;HANA_SAR&quot;);
        $variables{HANA_CLIENT_SAR} = get_required_var(&quot;HANA_CLIENT_SAR&quot;);
        qesap_yaml_replace(openqa_variables=&gt;\%variables);</code></pre>

<h3 id="qesap_configure_tfvar">qesap_configure_tfvar</h3>

<p>Generate a terraform.tfvars from a template.</p>

<dl>

<dt id="PROVIDER---cloud-provider-used-to-select-the-right-folder-in-the-qe-sap-deploy-repo"><b>PROVIDER</b> - cloud provider, used to select the right folder in the qe-sap-deploy repo</dt>
<dd>

</dd>
<dt id="REGION---cloud-region-where-to-perform-the-deployment.-Used-for-REGION"><b>REGION</b> - cloud region where to perform the deployment. Used for %REGION%</dt>
<dd>

</dd>
<dt id="RESOURCE_GROUP_POSTFIX---used-as-deployment_name-in-tfvars"><b>RESOURCE_GROUP_POSTFIX</b> - used as deployment_name in tfvars</dt>
<dd>

</dd>
<dt id="OS_VERSION---string-for-the-OS-version-to-be-used-for-the-deployed-machine.-Used-for-OSVER"><b>OS_VERSION</b> - string for the OS version to be used for the deployed machine. Used for %OSVER%</dt>
<dd>

</dd>
<dt id="SSH_KEY---Public-key-needed-in-tfvars"><b>SSH_KEY</b> - Public key needed in tfvars</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_configure_variables">qesap_configure_variables</h3>

<p>Generate the variables.sh loaded by build.sh and destroy.sh</p>

<dl>

<dt id="PROVIDER---cloud-provider-used-to-select-the-right-folder-in-the-qe-sap-deploy-repo1"><b>PROVIDER</b> - cloud provider, used to select the right folder in the qe-sap-deploy repo</dt>
<dd>

</dd>
<dt id="SAP_REGCODE---SCC-code"><b>SAP_REGCODE</b> - SCC code</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_configure_hanamedia">qesap_configure_hanamedia</h3>

<p>Generate the hana_media.yaml for Ansible</p>

<dl>

<dt id="SAPCAR---blob-server-url-for-the-SAPCAR"><b>SAPCAR</b> - blob server url for the SAPCAR</dt>
<dd>

</dd>
<dt id="IMDB_SERVER---blob-server-url-for-the-IMDB_SERVER"><b>IMDB_SERVER</b> - blob server url for the IMDB_SERVER</dt>
<dd>

</dd>
<dt id="IMDB_CLIENT---blob-server-url-for-the-IMDB_CLIENT"><b>IMDB_CLIENT</b> - blob server url for the IMDB_CLIENT</dt>
<dd>

</dd>
</dl>

<h3 id="qesap_sh">qesap_sh</h3>

<p>Generic handler for any qe-sap-deployment .sh scripts: calls and publish all the logs</p>

<h3 id="qesap_sh_deploy">qesap_sh_deploy</h3>

<p>Call build.sh and publish all the logs</p>

<h3 id="qesap_sh_destroy">qesap_sh_destroy</h3>

<p>Call destroy.sh and publish all the logs</p>

<h3 id="qesap_execute">qesap_execute</h3>

<pre><code>    qesap_execute(cmd =&gt; $qesap_script_cmd [, verbose =&gt; 1, cmd_options =&gt; $cmd_options] );
    cmd_options - allows to append additional qesap.py commans arguments like &quot;qesap.py terraform -d&quot;
        Example:
        qesap_execute(cmd =&gt; &#39;terraform&#39;, cmd_options =&gt; &#39;-d&#39;) will result in:
        qesap.py terraform -d

    Execute qesap glue script commands. Check project documentation for available options:
    https://github.com/SUSE/qe-sap-deployment</code></pre>

<h3 id="qesap_get_inventory">qesap_get_inventory</h3>

<pre><code>    Return the path of the generated inventory</code></pre>

<h3 id="qesap_prepare_env">qesap_prepare_env</h3>

<pre><code>    qesap_prepare_env(variables=&gt;{dict with variables}, provider =&gt; &#39;aws&#39;);

    Prepare terraform environment.
    - creates file structures
    - pulls git repository
    - external config files
    - installs pip requirements and OS packages
    - generates config files with qesap script

    For variables example see &#39;qesap_yaml_replace&#39;</code></pre>


</body>

</html>


